## database/
A db design for *Siirtokarjalaisten tie* data extracted with Kaira-core. Reads json-dataset generated by Kaira-core and creates
a Postgres database.

## kairatools/
An online web-interface for data exploration and manual fixing tasks

## Usage environment
For Windows and MS Access user, check the wiki for configuration guide. Basically you'll need Postgres ODBC drivers
and some configuration to connect to the database.

## Development environment
Following instructions are for Ubuntu but should be exactly same for Mac OSX with exception of how the general dependencies
are installed.

### General dependencies
* Python >=3.5
* Postgres 9.6.1
* PostGIS bundle for Postgres 9.6
* [PL/Python3](https://www.postgresql.org/docs/9.6/static/plpython.html) 
* virtualenv

After installing Postgres and Postgis, on Ubuntu you can install the plpython with:
```
sudo apt-get install -y postgresql-plpython3-9.6
```

### Setup Postgres .pgpass file
Set up postgres user to have a password access and then add following lines to `~/.pgpass`:

```
localhost:5432:learning-from-our-past:postgres:<password>
localhost:5432:karelian_testdb:postgres:<password>
```

Or if you don't want to use postgres user, you can create a new super user to your postgres cluster and
edit config files and make files correspondingly.

Add similar entry for production connection with correct host and passwords if you want to access the production database. 
Set rights of the file to the 0600. [Read more about PGPASSFILE ](https://www.postgresql.org/docs/9.6/static/libpq-pgpass.html)

### Setup the project
After database is setup and dependencies installed, run following make commands on the root directory of the project:
```
make create-venv
source database-venv/bin/activate
make setup
```

This should setup a new database called `learning-from-our-past` to your local postgres cluster. 
Finally run test command to check if all tests pass:

```
make test
```

If tests pass everything should be fine.

## Configure .env file for kairatools
Kairatools gets various configurations through environment variables which should be set for development environment. This can
be done via `.env` file. Create a new `.env` file to the root of the project with contents of `env-template` file and fill in 
details suitable for your local environment.

## Autoenv
Autoenv is a handy utility which automatically loads the `.env` file when you cd to the file. See instructions for installation here: https://github.com/kennethreitz/autoenv


